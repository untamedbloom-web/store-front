---
import Layout from "../layouts/Layout.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import { Image } from "astro:assets";

// Import images for the gallery
import img1 from "../assets/images/hero_wildflowers_moody.png";
import img2 from "../assets/images/about_florist_hands_earthy.png";
import img3 from "../assets/images/sourcing_flower_farm_colorado.png";
import img4 from "../assets/images/service-wedding.png";
import img5 from "../assets/images/service-alacarte.png";
import img6 from "../assets/images/service-workshop.png";
import img7 from "../assets/images/hero-bg-wildflowers.png";
import img8 from "../assets/images/intro-wildflowers-interactive.png";

const galleryImages = [
    {
        src: img1,
        alt: "Moody English garden vibes",
        span: "row-span-2 col-span-2",
    },
    {
        src: img4,
        alt: "Wedding floral arrangement",
        span: "row-span-1 col-span-1",
    },
    { src: img2, alt: "Florist hands working", span: "row-span-1 col-span-1" },
    {
        src: img3,
        alt: "Sustainable flower farm",
        span: "row-span-1 col-span-2",
    },
    { src: img5, alt: "A la carte bouquet", span: "row-span-2 col-span-1" },
    { src: img6, alt: "Floral workshop", span: "row-span-1 col-span-1" },
    {
        src: img8,
        alt: "Interactive wildflowers",
        span: "row-span-1 col-span-1",
    },
    {
        src: img7,
        alt: "Wildflowers at golden hour",
        span: "row-span-1 col-span-2",
    },
];
---

<Layout title="Gallery | Untamed Blooms">
    <Header slot="header" />

    <main class="gallery-page">
        <section class="page-header section-padding fade-in-up">
            <div class="container">
                <h1>Our Portfolio</h1>
                <p class="subtitle font-heading">
                    A visual journey through<br />untamed elegance.
                </p>
            </div>
        </section>

        <section class="gallery-section container">
            <div class="gallery-grid">
                {
                    galleryImages.map((image, index) => (
                        <div
                            class={`gallery-item ${image.span} fade-in-up delay-${(index % 3) * 100}`}
                        >
                            <Image
                                src={image.src}
                                alt={image.alt}
                                class="gallery-img"
                            />
                        </div>
                    ))
                }
            </div>
        </section>
    </main>

    <!-- Lightbox Modal -->
    <div id="lightbox" class="lightbox">
        <span class="close">&times;</span>
        <a class="prev">&#10094;</a>
        <img class="lightbox-content" id="lightbox-img" alt="Gallery preview" />
        <a class="next">&#10095;</a>
    </div>

    <Footer slot="footer" />
</Layout>

<script>
    const lightbox = document.getElementById("lightbox");
    const lightboxImg = document.getElementById(
        "lightbox-img",
    ) as HTMLImageElement;
    const closeBtn = document.querySelector(".close");
    const prevBtn = document.querySelector(".prev");
    const nextBtn = document.querySelector(".next");
    const galleryItems = document.querySelectorAll(".gallery-item");

    let currentIndex = 0;
    const totalImages = galleryItems.length;

    if (lightbox && lightboxImg && closeBtn && prevBtn && nextBtn) {
        const showImage = (index: number) => {
            const img = galleryItems[index].querySelector("img");
            if (img) {
                // Remove animation class, trigger reflow, re-add
                lightboxImg.classList.remove("fade-active");
                void lightboxImg.offsetWidth;
                lightboxImg.classList.add("fade-active");

                lightboxImg.src = img.src;
            }
        };

        const nextImage = () => {
            currentIndex = (currentIndex + 1) % totalImages;
            showImage(currentIndex);
        };

        const prevImage = () => {
            currentIndex = (currentIndex - 1 + totalImages) % totalImages;
            showImage(currentIndex);
        };

        // Open lightbox
        galleryItems.forEach((item, index) => {
            item.addEventListener("click", () => {
                const img = item.querySelector("img");
                if (img) {
                    currentIndex = index;
                    showImage(currentIndex);
                    lightbox.style.display = "block";
                    // Prevent scrolling on body
                    document.body.style.overflow = "hidden";
                }
            });
        });

        // Close functions
        const closeLightbox = () => {
            lightbox.style.display = "none";
            document.body.style.overflow = "auto";
        };

        closeBtn.addEventListener("click", closeLightbox);

        // Navigation clicks
        nextBtn.addEventListener("click", (e) => {
            e.stopPropagation();
            nextImage();
        });

        prevBtn.addEventListener("click", (e) => {
            e.stopPropagation();
            prevImage();
        });

        // Close on outside click
        window.addEventListener("click", (e) => {
            if (e.target === lightbox) {
                closeLightbox();
            }
        });

        // Keyboard navigation
        window.addEventListener("keydown", (e) => {
            if (lightbox.style.display === "block") {
                if (e.key === "Escape") closeLightbox();
                if (e.key === "ArrowRight") nextImage();
                if (e.key === "ArrowLeft") prevImage();
            }
        });
    }
</script>

<style>
    .page-header {
        text-align: center;
        padding-top: var(--spacing-md);
        padding-bottom: var(--spacing-lg);
    }

    .page-header h1 {
        font-family: var(--font-family-script);
        font-size: var(--font-size-6xl);
        color: var(--color-primary);
        line-height: 2.3;
    }

    .subtitle {
        font-size: 1.5rem;
        color: var(--color-secondary);
    }

    .gallery-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        grid-auto-rows: 250px;
        grid-auto-flow: dense;
        gap: var(--spacing-sm);
        padding-bottom: var(--spacing-xl);
    }

    @media (min-width: 768px) {
        .gallery-grid {
            grid-template-columns: repeat(3, 1fr);
        }

        .col-span-2 {
            grid-column: span 2;
        }
        .row-span-2 {
            grid-row: span 2;
        }
    }

    .gallery-item {
        position: relative;
        border-radius: var(--radius-sm);
        overflow: hidden;
        cursor: pointer;
    }

    .gallery-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.5s ease;
    }

    .gallery-item:hover .gallery-img {
        transform: scale(1.05);
    }

    .overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.3);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .gallery-item:hover .overlay {
        opacity: 1;
    }

    .icon {
        color: white;
        font-size: 2rem;
        font-weight: bold;
    }

    /* Lightbox Styles */
    .lightbox {
        display: none; /* Hidden by default */
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.9);
        animation: fadeIn 0.3s;
    }

    .lightbox-content {
        margin: auto;
        display: block;
        width: 80%;
        max-width: 1000px;
        max-height: 90vh;
        object-fit: contain;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        animation: zoomIn 0.3s;
        border-radius: var(--radius-sm);
    }

    .close {
        position: absolute;
        top: 20px;
        right: 35px;
        color: #f1f1f1;
        font-size: 40px;
        font-weight: bold;
        transition: 0.3s;
        z-index: 1001;
        cursor: pointer;
        font-family: sans-serif;
    }

    .close:hover,
    .close:focus {
        color: var(--color-accent);
        text-decoration: none;
        cursor: pointer;
    }

    /* Next & previous buttons */
    .prev,
    .next {
        cursor: pointer;
        position: absolute;
        top: 50%;
        width: auto;
        padding: 16px;
        margin-top: -50px;
        color: white;
        font-weight: bold;
        font-size: 30px;
        transition: 0.3s ease;
        border-radius: 0 3px 3px 0;
        user-select: none;
        z-index: 1002;
        text-decoration: none;
    }

    .next {
        right: 0;
        border-radius: 3px 0 0 3px;
    }

    .prev {
        left: 0;
        border-radius: 3px 0 0 3px;
    }

    .prev:hover,
    .next:hover {
        background-color: rgba(0, 0, 0, 0.8);
        color: var(--color-accent);
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }

    .fade-active {
        animation: fadeIn 0.4s ease-in-out;
    }

    @keyframes zoomIn {
        from {
            transform: translate(-50%, -50%) scale(0);
        }
        to {
            transform: translate(-50%, -50%) scale(1);
        }
    }

    /* Mobile Responsive Lightbox */
    @media only screen and (max-width: 700px) {
        .lightbox-content {
            width: 100%;
        }
    }
</style>
